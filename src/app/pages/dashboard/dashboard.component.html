<div class="layout">
  <aside class="sidebar">
    <div class="logo">Autobot</div>
    <nav>
      <a class="active">Dashboard</a>
    </nav>
    <div class="spacer"></div>
    <button class="mode" (click)="toggleDark()">{{ darkMode ? 'Light' : 'Dark' }} Mode</button>
  </aside>

  <div class="main">
    <header class="topbar">
      <div class="left">
        <span class="token" [style.background]="tokenColor()">
          Token:
          <ng-container *ngIf="authState?.ready; else disc">
            Connected â€” expires in {{ tokenCountdown() }}
          </ng-container>
          <ng-template #disc>Disconnected</ng-template>
        </span>
        <span class="sse-dot" [class.connected]="(md.connection$ | async)"></span>
      </div>
      <div class="right">
        <button *ngIf="!authState?.ready" (click)="loginWithUpstox()">Login with Upstox</button>
        <select multiple [(ngModel)]="selectedOptions" (change)="onSelectionChange()" [ngModelOptions]="{standalone: true}">
          <option *ngFor="let i of instruments" [ngValue]="i">{{ i }}</option>
        </select>
      </div>
    </header>

    <div class="content">
      <div class="stats">
        <div class="stat-card" *ngFor="let k of combinedInstruments; trackBy: trackByKey">
          {{ k }} LTP: {{ (nowLtp?.[k] ?? '-') }}
        </div>
        <div class="stat-card">Subscribed: {{ combinedInstruments.length }}</div>
      </div>
      <div class="charts">
        <app-candlestick-chart
          *ngIf="mainInstrument"
          [instrumentKey]="mainInstrument"></app-candlestick-chart>
        <ng-container *ngIf="selectedOptions?.length">
          <app-candlestick-chart
            *ngFor="let k of selectedOptions; trackBy: trackByKey"
            [instrumentKey]="k"></app-candlestick-chart>
        </ng-container>
      </div>
    </div>
  </div>
</div>
