<div class="history">
  <div class="header">
    <h3 class="muted">Sector CE/PE</h3>
    <div class="trade-filters">
      <span class="pill" [class.muted]="filterSide!=='both'" (click)="filterSideChange.emit('both')">All</span>
      <span class="pill" [class.muted]="filterSide!=='CE'" (click)="filterSideChange.emit('CE')">CE</span>
      <span class="pill" [class.muted]="filterSide!=='PE'" (click)="filterSideChange.emit('PE')">PE</span>
    </div>
  </div>
  <ng-container *ngIf="!loading; else loadingTpl">
    <table class="panel" *ngIf="rows.length; else emptyTpl">
      <thead>
        <tr>
          <th>Time</th>
          <th>Option</th>
          <th>Price</th>
          <th>Change</th>
          <th>Amount</th>
          <th>OI</th>
          <th>Tx</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td>{{ r.ts | date:'HH:mm:ss' }}</td>
          <td>{{ r.optionType }} {{ r.strike }}</td>
          <td>{{ r.ltp | number:'1.2-2' }}</td>
          <td>
            <span class="delta" [ngClass]="{up: r.changePct > 0, down: r.changePct < 0}">
              {{ r.changePct > 0 ? '+' : '' }}{{ r.changePct.toFixed(2) }}%
            </span>
          </td>
          <td>{{ r.qty }}</td>
          <td>{{ r.oi }}</td>
          <td title="{{ r.txId }}">{{ r.txId.slice(-6) }}</td>
        </tr>
      </tbody>
    </table>
    <ng-template #emptyTpl>
      <div class="panel" style="text-align:center; padding:24px">No trades yet</div>
    </ng-template>
  </ng-container>
  <ng-template #loadingTpl>
    <div class="panel" style="text-align:center; padding:24px">Loading...</div>
  </ng-template>
</div>
